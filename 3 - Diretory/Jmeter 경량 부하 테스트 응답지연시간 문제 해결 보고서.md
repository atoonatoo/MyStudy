

---
- [[0 Home]]
---

- 문제 요약
	- 비교적 작은 부하에도 로그인 응답시간에 지연이 발생한다.

- 파악한 문제
	- 로드밸런서 서버가 0~7로 갈수록 서버가 받은 요청수가 줄어든다.
	- 

| 포트   | 로그인 수 |
| ---- | ----- |
| 8080 | 1248  |
| 8081 | 720   |
| 8082 | 647   |
| 8083 | 670   |
| 8084 | 544   |
| 8085 | 516   |
| 8086 | 552   |
| 8087 | 471   |

- 클라이언트부터 시작해서 끝까지의 흐름을 찾아보자
- 

---


---

## 3. 실험 계획 및 절차

### 3.1 테스트 환경

- **JMeter 버전**: 5.6.3  
- **Spring Boot 버전**: 3.3.4  
- **동시 사용자 수**: 30~300명  
- **테스트 시간**: 300초  
- **리포트 저장**: `.jtl`, `.log`, `.csv` 포맷  

### 3.2 실험 목표

- 요청의 전 구간 흐름 파악  
- 응답 지연 또는 에러율이 높아지는 구간 식별  
- JMeter → LB → Web → DB로 이어지는 경로에서 병목 또는 누락 확인  

### 3.3 점검 경로

| 구간 | 점검 항목 |
|------|-----------|
| JMeter (Client) | 요청 수, 실패율, 타겟 URL 정확성, 타임아웃 여부 |
| DNS | 지연 여부, IP 주소 확인 |
| LB (Nginx) | 요청 분산 비율, 응답 지연, backend 서버 상태 |
| Web Server | access log, GC log, thread pool 상태, 예외 발생 여부 |
| DB | 쿼리 성능, 커넥션 풀 상태, 병목 쿼리 여부 |

---

## 4. 실험 및 분석 내용

### 4.1 JMeter 분석

- `result.jtl`과 `jmeter.log` 확인  
- 실패 요청 수 약 **13.53%**  
- 응답 시간 평균 **1300ms 이상** → 성능 저하 의심  
- 로그 파일 용량 **31MB 이상**, 단일 테스트 기준으론 무리 없음  

### 4.2 로드밸런서 분석

- `access.log`를 기반으로 포트별 요청 분포 확인  
- 일부 테스트에서 **8080 포트 요청 1157건 / 8081 포트 1631건**으로 **불균형 감지**  
- 요청의 90% 이상이 특정 포트로 몰릴 경우 → 분산 실패 가능성 있음  

### 4.3 웹 서버 분석

- 특정 서버에서 `ConnectionPoolExhausted`, GC 지연 경고 확인  
- `ThreadPool` 포화 현상 발생 → 톰캣 워커 수 부족 가능성  
- GC 로그 분석 결과, Minor GC 빈도 과다 → 메모리 조정 필요  

### 4.4 데이터베이스 분석

- 쿼리 실행시간 1000ms 이상인 슬로우 쿼리 다수 발견  
- DB 커넥션 수 과다 사용 → 풀 사이즈 제한 확인  
- 인덱스 미적용 테이블 확인  

---

## 5. 문제 요약 및 원인 도출

| 구간 | 원인 요약 |
|------|-----------|
| JMeter | 일부 스레드 실패, 무거운 요청 반복 |
| LB | 분산 불균형으로 특정 서버 포화 |
| 웹 서버 | ThreadPool/메모리 부족, GC 시간 증가 |
| DB | 느린 쿼리와 커넥션 병목 |

---

## 6. 개선안 제안

### 🔧 JMeter
- 로그 레벨 최소화  
- 요청 시 CSV 기반 유저 분산 및 전처리  

### 🔧 LB
- Weight 설정 점검 및 health check 기준 재설정  
- Nginx log 포맷 개선 (backend, 응답시간 표시)  

### 🔧 Web Server
- 톰캣 스레드 수 조정 (`maxThreads`)  
- GC 튜닝 (G1 GC로 전환, Heap 사이즈 조정)  

### 🔧 DB
- 슬로우 쿼리 튜닝, 인덱스 설계 재검토  
- 커넥션 풀 max 설정 조정  

---

## 7. 결론

본 테스트를 통해 단순히 "응답 지연"이라는 현상을 넘어서, **실제 어느 계층에서 문제가 발생하고 있었는지 체계적으로 분석**할 수 있었다.  
특히 로드밸런서 분산 불균형, 웹 서버 워커 포화, DB 쿼리 병목 등은 실제 실무에서 자주 발생하는 이슈로, 향후 장애 대응 시 이와 같은 로그 중심 분석이 핵심이 될 것이다.

---

