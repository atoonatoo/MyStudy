---
created:
---

---
- [[0 Home]]
---

- DBCP 개념
    - 백엔드 서버와 DB 서버는 TCP 기반으로 네트워크 통신을 한다.
    - TCP는 높은 송수신 신뢰성을 보장한다.
    - TCP는 연결 지향적인 특징이 있기 때문에 데이터 송수신 이전에 연결(connection)하는 과정이 필요하다.
    - 또한 데이터 송수신이 끝난 후에 연결을 끊어 주는 과정도 필요하다.
    - 매번 connection을 열고 닫는 건 시간적인 비용이 발생하며 이는 서비스의 성능에 악영향을 준다.
    - 이러한 문제를 해결하기 위해 만들어진 것이 DBCP(DB connection pool)이다.
    - DBCP는 미리 연결해놓고 놀고있는 DB connection들을 풀장에 모아 놓았다고 상상하면 좋다.
- DBCP 동작 원리
    - 그렇다면 DBCP는 어떻게 동작하는가?
    - 백엔드 서버와 DB 서버가 있다고 가정할 때, 본격적으로 API 요청을 받기전에 DB 커넥션을 미리 연결하는 해놓고 연결해놓은 DB 커넥션들을 마치 풀장에서 관리하는 것처럼 생각하자.
    -  이 상태에서 API 요청을 받게되면 백엔드 서버에서 해당 요청을 처리하다가 DB에 가서 데이터를 조회할 일이 생겼다고 가정한다.
    - 그럼 새로 DB 커넥션을 연결하는 것이 아니라 미리 연결해놓은 커넥션 풀이 있기 때문에 커넥션 풀에서 놀고 있는 커넥션 하나를 빌려와서 쿼리 요청에 사용된다.
    - 적절한 셀렉트문을 통해 DB는 데이터를 조회했을 것이다 그 데이터를 백엔드 서버쪽으로 쿼리 응답으로 반환하여 보내준다.
    - 쿼리 응답을 받은 백엔드 서버는 커넥션을 close connection 처리를 해준다.
    - 단, 여기서 close connection은 실제 커넥션을 종료하는 것이 아니라 DBCP에 빌려온 커넥션을 다시 반환한다.
    - 그 후 나머지 처리가 다 끝난 후에 API 응답을 처리하며 끝난다.
    - DBCP의 핵심을 정리하자면 DB는 TCP기반 연결에 대한 열고 닫는 시간적 비용을 절약하기 위해, 미리 DB에 여러개의 커넥션을 연결하고 그 커넥션들을 풀에 관리한다.
    - 그리고 쿼리 요청이 필요한 경우 DBCP에 놀고있는 커넥션 하나를 빌려서 쿼리 요청에 사용 후 쿼리 응답 후에 빌려온 커넥션을 제거하는 것이 아닌 기존에 관리되었던 DBCP에 반환한다.
    - 이게 바로 DatabaseConnectionpool, 줄여서 DBCP라고 부른다.
- DBCP 설정 방법
    - DB마다 설정 방법이 다르기때문에 본 포스팅은 MySQL을 기준으로 설명한다.
    - 백엔드 어플리케이션에 사용될 DBCP는 스프링부트 2.0부터 들어간 HikariCP를 기준으로 설명한다.
    - DB connection은 backend server와 db server 사이의 연결을 의미하기 때문에 backend server와 db server

---